<div class="flex flex-col md:flex-row h-screen bg-slate-100 p-4 gap-4 overflow-hidden">
    
    <div class="w-full md:w-8/12 h-full flex flex-col">
        
        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-2">
                <button pButton icon="pi pi-arrow-left" 
                        class="p-button-rounded p-button-text p-button-secondary" 
                        routerLink="/admin/productos" 
                        pTooltip="Volver al Inventario">
                </button>
                
                <h2 class="text-2xl font-bold text-slate-700 m-0 flex items-center">
                    <i class="pi pi-th-large mr-2"></i> Menú
                </h2>
            </div>

            <button pButton icon="pi pi-refresh" class="p-button-rounded p-button-text" (click)="loadProducts()" pTooltip="Actualizar Stock"></button>
        </div>
        
        <div class="flex-grow overflow-y-auto pr-2">
            <div *ngIf="products.length === 0" class="text-center mt-10 text-gray-500">
                <i class="pi pi-box text-4xl mb-2"></i>
                <p>No hay productos cargados o no hay conexión.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <div *ngFor="let p of products" 
                     class="bg-white rounded-xl shadow-md p-3 cursor-pointer transition hover:-translate-y-1 hover:shadow-lg flex flex-col relative h-full"
                     (click)="addToCart(p)">
                    
                    <span [class]="'absolute top-2 right-2 px-2 py-1 text-xs font-bold text-white rounded z-10 ' + (p.stock > 5 ? 'bg-green-500' : (p.stock > 0 ? 'bg-orange-500' : 'bg-red-500'))">
                        {{p.stock}} und
                    </span>

                    <img [src]="p.imagen_url || 'https://placehold.co/200x150?text=Plato'" 
                         class="w-full h-32 object-cover rounded-lg mb-3">

                    <div class="font-bold text-slate-800 mb-1 text-lg leading-tight">{{p.nombre}}</div>
                    
                    <div class="mt-auto flex justify-between items-center pt-2 border-t border-gray-100">
                        <span class="text-xl font-bold text-blue-600">S/ {{p.precio | number:'1.2-2'}}</span>
                        <i class="pi pi-plus-circle text-2xl text-blue-500"></i>
                    </div>
                    
                    <div *ngIf="p.stock === 0" class="absolute inset-0 bg-white/70 flex items-center justify-center rounded-xl z-20 cursor-not-allowed">
                        <span class="bg-red-600 text-white px-3 py-1 font-bold rounded shadow-md -rotate-12">AGOTADO</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="w-full md:w-4/12 h-full flex flex-col bg-white shadow-lg rounded-xl overflow-hidden border border-gray-200">
            
        <div class="p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
            <h3 class="m-0 text-xl font-bold text-slate-700">Orden Actual</h3>
            <span class="text-sm font-medium bg-blue-100 text-blue-800 px-2 py-1 rounded">
                {{ cartService.getCart().length }} items
            </span>
        </div>

        <div class="flex-grow overflow-y-auto p-3 space-y-2">
            
            <div *ngIf="cartService.getCart().length === 0" class="flex flex-col items-center justify-center h-64 text-gray-400">
                <i class="pi pi-shopping-cart text-6xl mb-3"></i>
                <p class="font-medium text-lg">Carrito Vacío</p>
                <small>Selecciona productos para vender</small>
            </div>

            <div *ngFor="let item of cartService.getCart()" 
                 class="flex items-center p-3 border border-gray-100 rounded hover:bg-slate-50 transition-colors group relative">
                
                <div class="w-10 h-10 bg-blue-600 text-white font-bold flex items-center justify-center rounded mr-3 shrink-0">
                    x{{item.cantidad}}
                </div>

                <div class="flex-grow min-w-0">
                    <div class="font-bold text-slate-800 text-sm truncate">{{item.nombre}}</div>
                    <div class="text-xs text-gray-500">P.U: S/ {{item.precio}}</div>
                </div>

                <div class="font-bold text-slate-700 mr-3 shrink-0">
                    S/ {{item.cantidad * item.precio | number:'1.2-2'}}
                </div>

                <button pButton icon="pi pi-trash" 
                        class="p-button-rounded p-button-text p-button-danger p-button-sm"
                        (click)="removeItem(item.producto_id)">
                </button>
            </div>
        </div>

        <div class="p-4 bg-gray-50 border-t border-gray-200">
            <div class="flex justify-between items-end mb-4">
                <span class="text-gray-600 font-medium text-lg">Total a Pagar</span>
                <span class="text-4xl font-bold text-slate-800">S/ {{cartService.getTotal() | number:'1.2-2'}}</span>
            </div>

            <button pButton label="PROCESAR VENTA" icon="pi pi-check-circle" 
                    class="w-full p-button-lg font-bold p-button-success"
                    [loading]="loading"
                    [disabled]="cartService.getCart().length === 0"
                    (click)="processSale()">
            </button>
        </div>

    </div>
</div>

<p-toast position="bottom-center"></p-toast>